{% extends 'base.html' %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Header -->
            <div class="card shadow-sm border-0 rounded-4 mb-4 bg-primary text-white"
                style="background: linear-gradient(135deg, #FF6B6B 0%, #556270 100%);">
                <div class="card-body p-5 text-center">
                    <h1 class="fw-bold mb-2">ðŸ“° Trending Market News</h1>
                    <p class="lead mb-0 opacity-75">Stay updated with the latest happenings in the stock market</p>
                </div>
            </div>

            <!-- News Grid -->
            <div id="news-container" class="row g-4">
                <div class="col-12 text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', fetchTrendingNews);

    async function fetchTrendingNews() {
        try {
            const res = await fetch('/api/stock_news'); // No ticker = general news
            const data = await res.json();
            const container = document.getElementById('news-container');

            if (!data.articles || data.articles.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center">
                        <div class="alert alert-info">No trending news available at the moment.</div>
                    </div>`;
                return;
            }

            container.innerHTML = data.articles.map(article => `
                <div class="col-md-6 mb-3">
                    <div class="card h-100 shadow-sm border-0 rounded-4 hover-card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <span class="badge bg-light text-primary border">${article.source || 'Market News'}</span>
                                <small class="text-muted">${formatDate(article.published_at)}</small>
                            </div>
                            <h5 class="card-title fw-bold mb-3">
                                <a href="${article.url}" target="_blank" class="text-dark text-decoration-none stretched-link hover-primary">
                                    ${article.title}
                                </a>
                            </h5>
                            <p class="card-text text-muted small line-clamp-3">
                                ${article.snippet || 'No description available.'}
                            </p>
                        </div>
                    </div>
                </div>
            `).join('');

        } catch (error) {
            console.error('Error fetching news:', error);
            document.getElementById('news-container').innerHTML = `
                <div class="col-12 text-center">
                    <div class="alert alert-danger">Failed to load news. Please try again later.</div>
                </div>`;
        }
    }

    function formatDate(dateString) {
        if (!dateString) return '';
        try {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: 'numeric', minute: 'numeric' });
        } catch (e) {
            return '';
        }
    }
</script>

<style>
    .hover-card {
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .hover-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 .5rem 1rem rgba(0, 0, 0, .15) !important;
    }

    .hover-primary:hover {
        color: #0d6efd !important;
        text-decoration: underline !important;
    }

    .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
{% endblock %}